<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    F嘉阳
</title>
<link rel="shortcut icon" href="https://fjiayang.github.io//favicon.ico?v=1575531807323">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://fjiayang.github.io//styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://fjiayang.github.io//media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="https://fjiayang.github.io/">
                <img class="avatar" src="https://fjiayang.github.io//images/avatar.png?v=1575531807323" alt="">
            </a>
            <div class="site-title">
                <h1>
                    F嘉阳
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="/" class="menu">
                                    首页
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/archives" class="menu">
                                    归档
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/tags" class="menu">
                                    标签
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/post/about" class="menu">
                                    关于
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-container main-container">
                <div id="content" class="main-container-left">
                    
        
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/mybatis-zhong-yu-dao-de-keng">
                        mybatis中遇到的坑
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-27</time>
                    
                        <a href="https://fjiayang.github.io//tag/dYu0hrq6S" class="post-tag i-tag
                            i-tag-warning">
            #Mybatis
        </a>
                        
                        <a href="https://fjiayang.github.io//tag/qV7V2kVvY" class="post-tag i-tag
                            i-tag-other_2">
            #Java
        </a>
                        
                        <a href="https://fjiayang.github.io//tag/olLQ2spNZ" class="post-tag i-tag
                            i-tag-success">
            #SpringBoot
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            mysql驱动问题
问题描述
问题发生时间（2018-12-27）
环境版本：

SpringBoot 2.1.1
Mybatis 1.3.2

原始配置
spring:
  datasource:
    driver-class-name:  com.mysql.jdbc.Driver
    username: hikaricp
    password: hikaricp
    url: jdbc:mysql://localhost:3306/db_test?characterEncoding=utf-8&amp;amp;useSSL=false

报错信息
Registered driver with driverClassName=com.mysql.jdbc.Driver was not found,

报错提示
Loading class `com.mysql.jdbc.Driver&#39;. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver&#39;. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.

解决办法
从提示中可看出，驱动名称有变，更正驱动名称即可
更正后配置
spring:
  datasource:
    driver-class-name:  com.mysql.cj.jdbc.Driver
    username: hikaricp
    password: hikaricp
    url: jdbc:mysql://localhost:3306/db_test?characterEncoding=utf-8&amp;amp;useSSL=false

同时若使用IDEA自带提示也可看出问题，有两种驱动都存在的问题，希望后续修复

另一种解决方案，从SpringBoot2.0之后连接池使用hikari，可根据url自动识别驱动，即如下配置也可成功运行
spring:
  datasource:
    username: hikaricp
    password: hikaricp
    url: jdbc:mysql://localhost:3306/db_test?characterEncoding=utf-8&amp;amp;useSSL=false

注解使用简化
前景提要
进入SpringBoot时代后“注解驱动开发”就已经成为趋势，mybatis官方也提供注解替代xml配置的方案
问题描述
问题发现时间（2018-12-27）
环境版本：

SpringBoot 2.1.1
Mybatis 1.3.2

在早期版本的mybatis-starter还需要进行实体映射xml文件配置，这次在使用1.3.2版本时再次查了下官方源码，发现已经无需使用映射文件，其底层会自动通过反射识别对象属性类型，并且去除了不少早期版本使用的注解（当前仍可以使用，但不使用功能正常）

无需手动创建SqlSession或DataSource
官方文档说明：

As you may already know, to use MyBatis with Spring you need at least an SqlSessionFactory and at least one mapper interface.
MyBatis-Spring-Boot-Starter will:

Autodetect an existing DataSource.
Will create and register an instance of a SqlSessionFactory passing that DataSource as an input using the SqlSessionFactoryBean.
Will create and register an instance of a SqlSessionTemplate got out of the SqlSessionFactory.
Autoscan your mappers, link them to the SqlSessionTemplate and register them to Spring context so they can be injected into your beans.


支持版本为Spring 4.3+

You just need to create a normal Spring boot application and let the mapper be injected like follows(available on Spring 4.3+):

@MapperScan -&amp;gt; @Mapper
早期版本需要在启动类上加上@MapperScan(basePackages = &amp;quot;xxx&amp;quot;)注解扫描mapper类，新版本可直接在mapper包上使用@Mapper注解即可

The MyBatis-Spring-Boot-Starter will search, by default, for mappers marked with the @Mapper annotation.

除非需要自定义注解或者不使用@Mapper才需要加上@MapperScan

You may want to specify a custom annotation or a marker interface for scanning. If so, you must use the @MapperScan annotation.

@Results与Mapper.xml
早期版本需要手动指定类型映射，并在resources目录下进行xml配置，新版本自动通过反射识别属性类型，无需进行xml配置

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/mybatis-zhong-yu-dao-de-keng">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/hbase-wei-fen-bu-shi-an-zhuang">
                        HBase伪分布式安装
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-15</time>
                    
                        <a href="https://fjiayang.github.io//tag/Of4MIljUs" class="post-tag i-tag
                            i-tag-">
            #HBase
        </a>
                        
                        <a href="https://fjiayang.github.io//tag/O_eaS7gae-" class="post-tag i-tag
                            i-tag-primary">
            #Hadoop
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            Hadoop伪分布式安装
基础环境

Hadoop：版本2.7.3，下载地址
HBase：版本1.2.4，下载地址
JDK8

jdk 安装命令
$ yum -y install java-devel java

查看当前系统jre和jdk路径，输入update-alternatives --config java和update-alternatives --config javac
$ update-alternatives --config java

共有 1 个提供“java”的程序。

  选项    命令
-----------------------------------------------
*+ 1           java-1.8.0-openjdk.x86_64 (/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.191.b12-1.el7_6.x86_64/jre/bin/java)

$ update-alternatives --config javac

共有 1 个提供“javac”的程序。

  选项    命令
-----------------------------------------------
*+ 1           java-1.8.0-openjdk.x86_64 (/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.191.b12-1.el7_6.x86_64/bin/javac)



查看环境
$ ll
总用量 311132
-rw-------. 1 root root      1241 8月  11 10:53 anaconda-ks.cfg
-rw-r--r--. 1 root root 214092195 8月  26 2016 hadoop-2.7.3.tar.gz
-rw-r--r--. 1 root root 104497899 10月 26 2016 hbase-1.2.4-bin.tar.gz
$ java -version
openjdk version &amp;quot;1.8.0_191&amp;quot;
OpenJDK Runtime Environment (build 1.8.0_191-b12)
OpenJDK 64-Bit Server VM (build 25.191-b12, mixed mode)
$ javac -version
javac 1.8.0_191

免密登录
新建hadoop用户，忽略密码强度提示
$ adduser hadoop
$ passwd hadoop

为方便远程连接和学习，同时授予root权限，输入whereis sudoers查看权限控制文件位置
$ whereis sudoers
sudoers: /etc/sudoers /etc/sudoers.d /usr/libexec/sudoers.so /usr/share/man/man5/sudoers.5.gz

vi /etc/sudoers修改内容为
root    ALL=(ALL)       ALL
hadoop  ALL=(ALL)       ALL

切换至hadoop用户，使用 ssh-keygen -t rsa生成私钥信息，位置在/home/hadoop/，并且忽略所有提示输入的信息
查看生成的文件，该SSH文件夹为隐藏文件夹，故用ls -a查看，可见自动生成了.ssh目录和id_rsa,id_rsa.pub两个文件
$ ls /home/hadoop/.ssh/
id_rsa  id_rsa.pub

复制公钥到.ssh目录
$ cp ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys

免密测试
$ ssh localhost
The authenticity of host &#39;localhost (::1)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:3UEr3lx2jznmN3FL3SflViR05IZe6AWweb3TeSsfX0M.
ECDSA key fingerprint is MD5:0f:31:c1:cc:54:69:7f:d8:8d:7c:8c:22:95:2e:03:4e.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;localhost&#39; (ECDSA) to the list of known hosts.
Last login: Sat Dec 15 11:14:27 2018
$ exit
登出
Connection to localhost closed.

安装Hadoop
解压文件
$ tar -zxvf hadoop-2.7.3.tar.gz

修改配置文件
$ vi /hadoop-2.7.3/etc/hadoop/hadoop-env.sh

配置Java路径
# The java implementation to use.
export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.191.b12-1.el7_6.x86_64

修改HDFS配置
$ vi /hadoop-2.7.3/etc/hadoop/hdfs-site.xml

配置内容
&amp;lt;configuration&amp;gt;
	&amp;lt;property&amp;gt;
	    &amp;lt;name&amp;gt;dfs.replication&amp;lt;/name&amp;gt;
	    &amp;lt;!-- 配置副本数量--&amp;gt;
	    &amp;lt;value&amp;gt;1&amp;lt;/value&amp;gt;
	&amp;lt;/property&amp;gt;
	&amp;lt;property&amp;gt;
	    &amp;lt;name&amp;gt;dfs.namenode.name.dir&amp;lt;/name&amp;gt;
	    &amp;lt;value&amp;gt;file:/home/hadoop/hadoop_data/dfs/name&amp;lt;/value&amp;gt;
	&amp;lt;/property&amp;gt;
	&amp;lt;property&amp;gt;
	    &amp;lt;name&amp;gt;dfs.namenode.data.dir&amp;lt;/name&amp;gt;
	    &amp;lt;value&amp;gt;file:/home/hadoop/hadoop_data/dfs/data&amp;lt;/value&amp;gt;
	&amp;lt;/property&amp;gt;
&amp;lt;/configuration&amp;gt;

手动创建相关目录
$ mkdir -p /home/hadoop/hadoop_data/dfs/name
$ mkdir -p /home/hadoop/hadoop_data/dfs/data

配置core-site.xml，内容为
&amp;lt;configuration&amp;gt;
    &amp;lt;property&amp;gt;
        &amp;lt;name&amp;gt;fs.defaultFS&amp;lt;/name&amp;gt;
        &amp;lt;!-- 配置主机IP--&amp;gt;
        &amp;lt;value&amp;gt;hdfs://0.0.0.0:8020&amp;lt;/value&amp;gt;
    &amp;lt;/property&amp;gt;

    &amp;lt;!-- 配置临时文件位置--&amp;gt;
    &amp;lt;property&amp;gt;
        &amp;lt;name&amp;gt;hadoop.tmp.dir&amp;lt;/name&amp;gt;
        &amp;lt;value&amp;gt;file:/home/hadoop/hadoop_data&amp;lt;/value&amp;gt;
    &amp;lt;/property&amp;gt;
&amp;lt;/configuration&amp;gt;

放行端口并重载
$ firewall-cmd --zone=public --add-port=8020/tcp --add-port=50070/tcp --permanent
$ firewall-cmd --reload

启动Hadoop
初始化
进入/hadoop-2.7.3/bin目录，使用如下语句初始化Hadoop，该操作仅执行一次即可，以后使用无需重复执行，否则执行后会删除当前hadoop上的所有文件
$ hadoop namenode -format

滚动均为info级别的日志并且status 0表示已初始化成功
...
18/12/15 17:07:32 INFO namenode.FSImage: Allocated new BlockPoolId: BP-99731851-127.0.0.1-1544864852133
18/12/15 17:07:32 INFO common.Storage: Storage directory /home/hadoop/hadoop_data/dfs/name has been successfully formatted.
18/12/15 17:07:32 INFO namenode.FSImageFormatProtobuf: Saving image file /home/hadoop/hadoop_data/dfs/name/current/fsimage.ckpt_0000000000000000000 using no compression
18/12/15 17:07:32 INFO namenode.FSImageFormatProtobuf: Image file /home/hadoop/hadoop_data/dfs/name/current/fsimage.ckpt_0000000000000000000 of size 353 bytes saved in 0 seconds.
18/12/15 17:07:32 INFO namenode.NNStorageRetentionManager: Going to retain 1 images with txid &amp;gt;= 0
18/12/15 17:07:32 INFO util.ExitUtil: Exiting with status 0
18/12/15 17:07:32 INFO namenode.NameNode: SHUTDOWN_MSG: 
/************************************************************
SHUTDOWN_MSG: Shutting down NameNode at localhost/127.0.0.1
************************************************************/

启动HDFS
进入/hadoop-2.7.3/sbin目录输入./start-dfs.sh启动HDFS服务
$ ./start-dfs.sh
Starting namenodes on [0.0.0.0]
The authenticity of host &#39;0.0.0.0 (0.0.0.0)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:3UEr3lx2jznmN3FL3SflViR05IZe6AWweb3TeSsfX0M.
ECDSA key fingerprint is MD5:0f:31:c1:cc:54:69:7f:d8:8d:7c:8c:22:95:2e:03:4e.
Are you sure you want to continue connecting (yes/no)? yes
0.0.0.0: Warning: Permanently added &#39;0.0.0.0&#39; (ECDSA) to the list of known hosts.
0.0.0.0: starting namenode, logging to /home/hadoop/hadoop-2.7.3/logs/hadoop-hadoop-namenode-localhost.localdomain.out
localhost: starting datanode, logging to /home/hadoop/hadoop-2.7.3/logs/hadoop-hadoop-datanode-localhost.localdomain.out
Starting secondary namenodes [0.0.0.0]
0.0.0.0: starting secondarynamenode, logging to /home/hadoop/hadoop-2.7.3/logs/hadoop-hadoop-secondarynamenode-localhost.localdomain.out

进程验证，若出现如下四个进程表示HDFS服务启动成功
$ jps
28930 Jps
28821 SecondaryNameNode
28663 DataNode
28541 NameNode

配置hdfs命令
使用vi ~/.bash_profile进入配置文件，按如下配置
export HADOOP_HOME=/home/hadoop/hadoop-2.7.3
export PATH=$HADOOP_HOME/bin:$PATH

使配置文件生效source ~/.bash_profile
输入hdfs回车测试命令是否生效，若出现如下画面则表示命令已经生效
$ hdfs
Usage: hdfs [--config confdir] [--loglevel loglevel] COMMAND
       where COMMAND is one of:
  dfs                  run a filesystem command on the file systems supported in Hadoop.
  classpath            prints the classpath
  namenode -format     format the DFS filesystem
  secondarynamenode    run the DFS secondary namenode
  namenode             run the DFS namenode
  journalnode          run the DFS journalnode
  zkfc                 run the ZK Failover Co
  ...

命令测试
$ hadoop fs -mkdir /test
$ hadoop fs -ls /
Found 1 items
drwxr-xr-x   - hadoop supergroup          0 2018-12-15 17:14 /test

HBase伪分布式搭建
HBase安装
解压安装包，目录如下
$ ll
总用量 320
drwxr-xr-x.  4 hadoop hadoop   4096 1月  29 2016 bin
-rw-r--r--.  1 hadoop hadoop 122439 10月 26 2016 CHANGES.txt
drwxr-xr-x.  2 hadoop hadoop    178 1月  29 2016 conf
drwxr-xr-x. 12 hadoop hadoop   4096 10月 26 2016 docs
drwxr-xr-x.  7 hadoop hadoop     80 10月 26 2016 hbase-webapps
-rw-rw-r--.  1 hadoop hadoop    261 10月 26 2016 LEGAL
drwxrwxr-x.  3 hadoop hadoop   8192 12月 15 11:24 lib
-rw-rw-r--.  1 hadoop hadoop 130696 10月 26 2016 LICENSE.txt
-rw-rw-r--.  1 hadoop hadoop  42025 10月 26 2016 NOTICE.txt
-rw-r--r--.  1 hadoop hadoop   1477 12月 27 2015 README.txt

拷贝Hadoop配置文件到/conf目录
$ cp /home/hadoop/hadoop-2.7.3/etc/hadoop/hdfs-site.xml .
$ cp /home/hadoop/hadoop-2.7.3/etc/hadoop/core-site.xml .

修改hbase-env.sh文件，增加JDK路径
# The java implementation to use.  Java 1.7+ required.
export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.191.b12-1.el7_6.x86_64

由于使用的是jdk8，主要注释内存配置
# Configure PermSize. Only needed in JDK7. You can safely remove it for JDK8+
#export HBASE_MASTER_OPTS=&amp;quot;$HBASE_MASTER_OPTS -XX:PermSize=128m -XX:MaxPermSize=128m&amp;quot;
#export HBASE_REGIONSERVER_OPTS=&amp;quot;$HBASE_REGIONSERVER_OPTS -XX:PermSize=128m -XX:MaxPermSize=128m&amp;quot;

另外打开文件最后zookeeper配置，设置为使用内置的zookeeper
# Tell HBase whether it should manage it&#39;s own instance of Zookeeper or not.
export HBASE_MANAGES_ZK=true

修改hbase-site.xml文件，内容如下
&amp;lt;configuration&amp;gt;
	&amp;lt;property&amp;gt;
		&amp;lt;name&amp;gt;hbase.rootdir&amp;lt;/name&amp;gt;
        &amp;lt;!-- 配置文件根目录--&amp;gt;
		&amp;lt;value&amp;gt;hdfs://localhost:8020/hbase&amp;lt;/value&amp;gt;
	&amp;lt;/property&amp;gt;
	&amp;lt;property&amp;gt;
		&amp;lt;name&amp;gt;hbase.zookeeper.property.dataDir&amp;lt;/name&amp;gt;
		&amp;lt;value&amp;gt;/home/hadoop/hadoop_data/zookeeper&amp;lt;/value&amp;gt;
	&amp;lt;/property&amp;gt;
	&amp;lt;property&amp;gt;
		&amp;lt;name&amp;gt;hbase.cluster.distributed&amp;lt;/name&amp;gt;
        &amp;lt;!-- 配置以集群方式运行--&amp;gt;
		&amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;
	&amp;lt;/property&amp;gt;
&amp;lt;/configuration&amp;gt;

参考文档
启动HBase
在/bin目录下执行./start-hbase.sh启动HBase
$ ./start-hbase.sh 
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
localhost: starting zookeeper, logging to /home/hadoop/hbase-1.2.4/bin/../logs/hbase-hadoop-zookeeper-localhost.localdomain.out
localhost: OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
starting master, logging to /home/hadoop/hbase-1.2.4/bin/../logs/hbase-hadoop-master-localhost.localdomain.out
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
starting regionserver, logging to /home/hadoop/hbase-1.2.4/bin/../logs/hbase-hadoop-1-regionserver-localhost.localdomain.out

由于虚拟机只分配了单核单线程，GC警告暂时忽略
进程验证，确认启动成功
$ jps
28821 SecondaryNameNode
28663 DataNode
29911 HRegionServer
29785 HMaster
29724 HQuorumPeer
28541 NameNode
30303 Jps

进入HBase命令行测试
$ ./hbase shell
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/home/hadoop/hbase-1.2.4/lib/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/home/hadoop/hadoop-2.7.3/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]
HBase Shell; enter &#39;help&amp;lt;RETURN&amp;gt;&#39; for list of supported commands.
Type &amp;quot;exit&amp;lt;RETURN&amp;gt;&amp;quot; to leave the HBase Shell
Version 1.2.4, r67592f3d062743907f8c5ae00dbbe1ae4f69e5af, Tue Oct 25 18:10:20 CDT 2016

hbase(main):001:0&amp;gt; status
1 active master, 0 backup masters, 1 servers, 0 dead, 2.0000 average load

hbase(main):002:0&amp;gt; 

查看其是否自动在HDFS上创建目录/hbase
$ hadoop fs -ls /
Found 2 items
drwxr-xr-x   - hadoop supergroup          0 2018-12-15 18:43 /hbase
drwxr-xr-x   - hadoop supergroup          0 2018-12-15 17:14 /test


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/hbase-wei-fen-bu-shi-an-zhuang">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/hbase-xue-xi-bi-ji">
                        HBase 学习笔记
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-15</time>
                    
                        <a href="https://fjiayang.github.io//tag/Of4MIljUs" class="post-tag i-tag
                            i-tag-info">
            #HBase
        </a>
                        
                        <a href="https://fjiayang.github.io//tag/O_eaS7gae-" class="post-tag i-tag
                            i-tag-error">
            #Hadoop
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            概述
HBase 简介

Hbase是一个分布式的、面向列的开源数据库

列式数据库：将列值统一存储
行式数据库：关系型数据库，将每一行值统一存储


Hbase在Hadoop之上提供了类似于Bigtable的能力

Bigtable是压缩、高性能、高可扩展性的基于Google GFS文件系统的数据库，用于存储大规模的结构化数据，在扩展性和性能上有很大的优势


Hbase不同于一般的关系数据库，它适合非结构化数据存储

非结构化数据：不能用二维表进行存储的数据，例如图片、文档等



Hbase地位

Apache基金会顶级项目
基于Hadoop核心HDFS系统进行数据存储，类似于Hive
可以存储超大数据并适合用来进行大数据的的实时查询

Hbase与HDFS

Hbase建立在Hadoop文件系统上，利用了Hadoop文件系统的容错能力
Hbase提供对数据随机实时读/写访问功能
Hbase内部使用哈希表存储索引，可将HDFS文件中的数据进行快速查找

适用场景

瞬间写入量很大，常用数据库不好支持或者需要很高的成本支撑
数据需要长久保存，且数据量会持久增长到比较大的场景
Hbase不适合用于有join、多级索引、表关系复杂的数据模型

存储模型与原理
CAP定理
分布式系统的CAP理论：理论首先把分布式系统中的三个特性进行了如下归纳：


一致性（C）：所有节点在同一时间具有相同的数据


可用性（A）：保证每个请求不管成功或者失败（包含节点宕机）都有响应，但不保证获取数据的正确性


分区容错性（P）：系统中任意信息的丢失或失败不会影响系统的继续运作。系统如果不能在时限内达成数据一致性，必须就当前操作在C和A之间做出选择。


Hbase为CP特性
ACID
ACID的定义：

Atomic原子性:所有的步骤要么全部完成要么一个也不会完成
Consistent一致性: 通过各种途径包括外键约束等任何写入数据库的数据都是有效的，不能发生表与表之间存在外键约束
Isolated隔离性: 一个未完成事务不会影响另外一个未完成事务
Durable持久性: 一旦一个事务被提交，它应该持久保存

HBase非强ACID
HBase概念



字段
概念
备注




NameSpace
类似RDBMS的“数据库”



Table
表名必须是能用在文件路径里的合法名字
原因：每个表都会映射为HDFS的文件


Row
在表里，每一行代表一个数据对象，每一行都以一个行键（Row Key）来唯一标识的，行键没有特定的数据类型，以二进制的字节进行存储



Row Key
唯一标识一行记录，不可改变，只能删除



Column
由Column family和Column qualifier组成，由（：）进行分隔
例如：family：qualifier


Column family
在定义HBase表的时候需要提前设置好列族，表中所有的列都需要组织在列族里面
同一个列族的成员有相同的前缀，物理上，一个列族的成员都是储存在一起，用于存储优化


Column qualifier（列限定符）
列族中的数据通过列标识来进行映射，可以理解为一个键值对，Column qualifier就是Key
类似具体的列名


Cell
每一个行键，列族和列标识共同组成的一个单元
无特定的数据类型，以二进制字节存储


Timestamp
每个值都有一个Timestamp，作为该值特定版本的标识符
读未指定版本则返回最新版，写未指定时间则使用当前时间，HBase默认保留3个版本数据



HBase与传统关系数据库的区别




Hbase
RDBMS




数据库大小
PB
GB、TB


数据类型
Bytes
丰富的数据类型


事务支持
ACID只支持单个Row级别
全面的ACID支持


索引
只支持Row-Key
支持


吞吐量
百万查询/每秒
数千查询/每秒



HBase基础架构

HBase分布式系统简介

HMaster

HBase主/从集群架构中的中央节点
负责将region（HBase中存储最小单元，表格的基本单位）分配给RegionServer，协调RegionServer的负载并维护集群状态
维护表和Region的元数据，不参与数据的输入/输出过程


RegionServer

维护HMaster分配给他的region，处理对这些region的IO请求
负责切分正在运行过程中变得过大的region


Zookeeper

集群协调器，保证至少一个节点出于active状态
HMaster启动将系统表加载到ZK（用于服务发现）
提供HBase RegionServer状态信息



HBase原理
HBase写流程


Client先访问zookeeper，得到对应的RegionServer地址
Client对RegionServer发起写请求，RegionServer接受数据写入内存
当MemStore的大小达到一定值后，flush到StoreFile并存储到HDFS


HBase特殊点在于其先写内存再写日志，通过类似MySQL中MVCC机制保证一致性
HBase读流程


Client先访问zookeeper，得到对应的RegionServer地址
Client对RegionServer发起读请求
当RegionServer收到client的读请求后，先扫描自己的Memstore，再扫描BlockCache（加速读内容缓存区）如果还没找到则从StoreFile中读取数据，然后将数据返回给Client

读特点

读过程与HMaster无关，只和ZK有关，有效的减小HMaster负载

HBase模块协作
有关HBase的三个问题

HBase启动时发生了什么
当RegionServer失效后会发生什么
当HMaster失效后会发生什么

HBase启动

HBase启动，注册到zookeeper，等待RegionServer汇报
RegionServer注册到zookeeper，并向HMaster汇报
对各个RegionServer（包括失效的）的数据进行整理，分配Region和meta信息（所有表的索引）

RegionServer失效

HMaster将失效RegionServer上的Region分配到其他节点
HMaster更新HBase：meta表保证数据正常访问

HMaster失效
配置高可用后

出于Backup状态的其他HMaster节点选举出一个转为Active状态

未配置高可用

数据能正常读写，但不能创建删除表，也不能更改表结构，因为涉及meta表更新


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/hbase-xue-xi-bi-ji">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/java8-sheng-chan-huan-jing-xia-xing-neng-jian-kong-yu-diao-you-xiang-jie-bi-ji">
                        Java8生产环境下性能监控与调优详解笔记
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-09</time>
                    
                        <a href="https://fjiayang.github.io//tag/qV7V2kVvY" class="post-tag i-tag
                            i-tag-other_4">
            #Java
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            [toc]
官方文档
JDK命令行参数
标准化参数，各个jvm版本中不变
-参数
-help
-version
-server
-client
非标准化参数，不同jvm版本可能会变化
-X参数
-Xint:解释执行
-Xcomp:第一次全部编译成本地代码（首次运行速度慢）
-Xmixed:混合模式（默认），JVM自己决定是否编译成本地代码
PS C:\Users\11860&amp;gt; java -version
java version &amp;quot;1.8.0_151&amp;quot;
Java(TM) SE Runtime Environment (build 1.8.0_151-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.151-b12, mixed mode)

-XX参数
布尔类型
格式：-XX:[+-]表示启用或禁用
-XX:+UseConcMarkSweepGC 表示启用CMS垃圾回收器
-XX:+UseG1GC 表示启用G1垃圾回收器
值类型
格式：-XX:=表示name属性的值是value
-XX:MaxGCPauseMillis=500 表示GC最大停顿时间为500
-XX:GCTimeRatio=19
-Xms -Xmx
-Xms等价于-XX:InitialHeapSize 即初始化堆大小
-Xmx等价于-XX:MaxHeapSize 最大堆大小
JVM运行时参数
-XX:+PrintFlagsInitial 查看初始值
-XX:+PrintFlagsFinal 查看最终值
-XX:+UnlockDiagnosticVMOptions 解锁诊断参数
-XX:+PrintCommandLineFlags 打印命令行参数
+PrintFlagsFinal
= 即默认值
:= 即用户或JVM修改后的值
PS C:\Users\11860&amp;gt; java -XX:+PrintFlagsFinal -version
[Global flags]
    uintx AdaptiveSizeDecrementScaleFactor          = 4                                   {product}
    uintx AdaptiveSizeMajorGCDecayTimeScale         = 10                                  {product}
    uintx AdaptiveSizePausePolicy                   = 0                                   {product}
    uintx AdaptiveSizePolicyCollectionCostMargin    = 50                                  {product}
    uintx InitialCodeCacheSize                      = 2555904                             {pd product}
    uintx InitialHeapSize                          := 268435456                           {product}
    bool UseG1GC                                    = false                                {product}

jps
专用于查看java进程
PS C:\Users\11860&amp;gt; jps
14624 Jps
10248
14168 proxyee-down.exe
2120 RemoteMavenServer
5192 main\proxyee-down-core.jar


jps -l显示全称

PS C:\Users\11860&amp;gt; jps -l
10248
14168 proxyee-down-2.54\proxyee-down.exe
1800 sun.tools.jps.Jps
2120 org.jetbrains.idea.maven.server.RemoteMavenServer
5192 /proxyee-down-2.54/main\proxyee-down-core.jar

命令参考地址
jinfo
查看正在运行的java程序参数
PS C:\Users\11860&amp;gt; jinfo
Usage:
    jinfo [option] &amp;lt;pid&amp;gt;
        (to connect to running process)
    jinfo [option] &amp;lt;executable &amp;lt;core&amp;gt;
        (to connect to a core file)
    jinfo [option] [server_id@]&amp;lt;remote server IP or hostname&amp;gt;
        (to connect to remote debug server)

where &amp;lt;option&amp;gt; is one of:
    -flag &amp;lt;name&amp;gt;         to print the value of the named VM flag
    -flag [+|-]&amp;lt;name&amp;gt;    to enable or disable the named VM flag
    -flag &amp;lt;name&amp;gt;=&amp;lt;value&amp;gt; to set the named VM flag to the given value
    -flags               to print VM flags
    -sysprops            to print Java system properties
    &amp;lt;no option&amp;gt;          to print both of the above
    -h | -help           to print this help message

查看最大内存

jinfo -flag MaxHeapSize

PS C:\Users\11860&amp;gt; jinfo -flag MaxHeapSize 2120
-XX:MaxHeapSize=805306368

查看垃圾回收器

jinfo -flag  UseG1GC

jstat
查看jvm统计信息
PS C:\Users\11860&amp;gt; jstat -help
Usage: jstat -help|-options
       jstat -&amp;lt;option&amp;gt; [-t] [-h&amp;lt;lines&amp;gt;] &amp;lt;vmid&amp;gt; [&amp;lt;interval&amp;gt; [&amp;lt;count&amp;gt;]]

Definitions:
  &amp;lt;option&amp;gt;      An option reported by the -options option
  &amp;lt;vmid&amp;gt;        Virtual Machine Identifier. A vmid takes the following form:
                     &amp;lt;lvmid&amp;gt;[@&amp;lt;hostname&amp;gt;[:&amp;lt;port&amp;gt;]]
                Where &amp;lt;lvmid&amp;gt; is the local vm identifier for the target
                Java virtual machine, typically a process id; &amp;lt;hostname&amp;gt; is
                the name of the host running the target Java virtual machine;
                and &amp;lt;port&amp;gt; is the port number for the rmiregistry on the
                target host. See the jvmstat documentation for a more complete
                description of the Virtual Machine Identifier.
  &amp;lt;lines&amp;gt;       Number of samples between header lines.
  &amp;lt;interval&amp;gt;    Sampling interval. The following forms are allowed:
                    &amp;lt;n&amp;gt;[&amp;quot;ms&amp;quot;|&amp;quot;s&amp;quot;]
                Where &amp;lt;n&amp;gt; is an integer and the suffix specifies the units as
                milliseconds(&amp;quot;ms&amp;quot;) or seconds(&amp;quot;s&amp;quot;). The default units are &amp;quot;ms&amp;quot;.
  &amp;lt;count&amp;gt;       Number of samples to take before terminating.
  -J&amp;lt;flag&amp;gt;      Pass &amp;lt;flag&amp;gt; directly to the runtime system.

官方文档
可选参数

-statOption
Determines the statistics information the jstat command displays. The following lists the available options. Use the -options general option to display the list of options for a particular platform installation. See Stat Options and Output.
class: Displays statistics about the behavior of the class loader.

compiler: Displays statistics about the behavior of the Java HotSpot VM Just-in-Time compiler.

gc: Displays statistics about the behavior of the garbage collected heap.

gccapacity: Displays statistics about the capacities of the generations and their corresponding spaces.

gccause: Displays a summary about garbage collection statistics (same as -gcutil), with the cause of the last and current (when applicable) garbage collection events.

gcnew: Displays statistics of the behavior of the new generation.

gcnewcapacity: Displays statistics about the sizes of the new generations and its corresponding spaces.

gcold: Displays statistics about the behavior of the old generation and metaspace statistics.

gcoldcapacity: Displays statistics about the sizes of the old generation.

gcmetacapacity: Displays statistics about the sizes of the metaspace.

gcutil: Displays a summary about garbage collection statistics.

printcompilation: Displays Java HotSpot VM compilation method statistics.


类加载

-class
Stat Options and Output
The following information summarizes the columns that the jstat command outputs for each statOption.
-class option
Class loader statistics.
Loaded: Number of classes loaded.

Bytes: Number of kBs loaded.

Unloaded: Number of classes unloaded.

Bytes: Number of Kbytes unloaded.

Time: Time spent performing class loading and unloading operations.


PS C:\Users\11860&amp;gt; jstat -class 2120
Loaded  Bytes  Unloaded  Bytes     Time
  4271  7387.1       98   137.6       3.28

垃圾收集
-gc
输出含义
S0C、S1C、S0U、S1U：S0和S1的总用量与使用量
EC、EU：Eden区总量与使用量
OC、OU：Old区总量与使用量
MC、MU：Metaspace区总量与使用量
CCSC、CCSU：压缩类空间总量与使用量
YGC、YGCT：YoungGC的次数与时间
FGC、FGCT：FullGC的次数与时间
GCT：总的GC时间
解释：S0=S1，同一时间只启用s1或s0，S0+S1+Eden=Young，内存堆=Young+Old
默认命令只输出一次
PS C:\Users\11860&amp;gt; jstat -gc 2120
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
35840.0 51712.0  0.0    0.0   158720.0 11900.5   102400.0    9199.6   24192.0 22964.4 2944.0 2550.2      8    0.314   2      0.154    0.468

指定输出参数为每隔一秒输出一次，共输出10次
PS C:\Users\11860&amp;gt; jstat -gc 5192 1000 10
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
4352.0 4352.0 2228.1  0.0   34944.0  19156.1   87424.0    75913.1   36864.0 35975.9  0.0    0.0     2338    7.004   8      0.459    7.463
4352.0 4352.0  0.0   2131.3 34944.0   7184.2   87424.0    76050.5   36864.0 35975.9  0.0    0.0     2339    7.006   8      0.459    7.466
4352.0 4352.0  0.0   2131.3 34944.0  31117.2   87424.0    76050.5   36864.0 35975.9  0.0    0.0     2339    7.006   8      0.459    7.466
4352.0 4352.0 2320.3  0.0   34944.0   8482.5   87424.0    76050.5   36864.0 35975.9  0.0    0.0     2340    7.009   8      0.459    7.468
4352.0 4352.0 2320.3  0.0   34944.0  29236.0   87424.0    76050.5   36864.0 35975.9  0.0    0.0     2340    7.009   8      0.459    7.468
4352.0 4352.0  0.0   2058.5 34944.0  11809.7   87424.0    76348.8   36864.0 35975.9  0.0    0.0     2341    7.012   8      0.459    7.471
4352.0 4352.0 2339.3  0.0   34944.0    0.0     87424.0    76348.8   36864.0 35975.9  0.0    0.0     2342    7.015   8      0.459    7.474
4352.0 4352.0 2339.3  0.0   34944.0  11533.3   87424.0    76348.8   36864.0 35975.9  0.0    0.0     2342    7.015   8      0.459    7.474
4352.0 4352.0  0.0   2076.1 34944.0   3826.1   87424.0    76520.6   36864.0 35975.9  0.0    0.0     2343    7.017   8      0.459    7.476
4352.0 4352.0  0.0   2076.1 34944.0  11102.7   87424.0    76520.6   36864.0 35975.9  0.0    0.0     2343    7.017   8      0.459    7.476

JIT编译
-complier
PS C:\Users\11860&amp;gt; jstat -compiler 2120
Compiled Failed Invalid   Time   FailedType FailedMethod
    5234      0       0    16.70          0

JVM内存结构

内存溢出
堆区内存溢出
非堆区内存溢出
导出内存映像文件
当内存溢出时自动导出
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=./
jmap命令手动导出
PS C:\Users\11860&amp;gt; jmap -help
Usage:
    jmap [option] &amp;lt;pid&amp;gt;
        (to connect to running process)
    jmap [option] &amp;lt;executable &amp;lt;core&amp;gt;
        (to connect to a core file)
    jmap [option] [server_id@]&amp;lt;remote server IP or hostname&amp;gt;
        (to connect to remote debug server)

where &amp;lt;option&amp;gt; is one of:
    &amp;lt;none&amp;gt;               to print same info as Solaris pmap
    -heap                to print java heap summary
    -histo[:live]        to print histogram of java object heap; if the &amp;quot;live&amp;quot;
                         suboption is specified, only count live objects
    -clstats             to print class loader statistics
    -finalizerinfo       to print information on objects awaiting finalization
    -dump:&amp;lt;dump-options&amp;gt; to dump java heap in hprof binary format
                         dump-options:
                           live         dump only live objects; if not specified,
                                        all objects in the heap are dumped.
                           format=b     binary format
                           file=&amp;lt;file&amp;gt;  dump heap to &amp;lt;file&amp;gt;
                         Example: jmap -dump:live,format=b,file=heap.bin &amp;lt;pid&amp;gt;
    -F                   force. Use with -dump:&amp;lt;dump-options&amp;gt; &amp;lt;pid&amp;gt; or -histo
                         to force a heap dump or histogram when &amp;lt;pid&amp;gt; does not
                         respond. The &amp;quot;live&amp;quot; suboption is not supported
                         in this mode.
    -h | -help           to print this help message
    -J&amp;lt;flag&amp;gt;             to pass &amp;lt;flag&amp;gt; directly to the runtime system

手动导出映像文件
PS C:\Users\11860&amp;gt; jmap -dump:format=b,file=heap.hprof 11720
Dumping heap to L:\heap.hprof ...
Heap dump file created

jmap相关命令
PS C:\Users\11860&amp;gt; jmap -heap 11720
Attaching to process ID 11720, please wait...
Debugger attached successfully.
Server compiler detected.
JVM version is 25.151-b12

using thread-local object allocation.
Parallel GC with 8 thread(s)

Heap Configuration:
   MinHeapFreeRatio         = 0
   MaxHeapFreeRatio         = 100
   MaxHeapSize              = 33554432 (32.0MB)
   NewSize                  = 11010048 (10.5MB)
   MaxNewSize               = 11010048 (10.5MB)
   OldSize                  = 22544384 (21.5MB)
   NewRatio                 = 2
   SurvivorRatio            = 8
   MetaspaceSize            = 21807104 (20.796875MB)
   CompressedClassSpaceSize = 1073741824 (1024.0MB)
   MaxMetaspaceSize         = 17592186044415 MB
   G1HeapRegionSize         = 0 (0.0MB)

Heap Usage:
PS Young Generation
Eden Space:
   capacity = 7864320 (7.5MB)
   used     = 6748264 (6.435646057128906MB)
   free     = 1116056 (1.0643539428710938MB)
   85.80861409505208% used
From Space:
   capacity = 1572864 (1.5MB)
   used     = 950272 (0.90625MB)
   free     = 622592 (0.59375MB)
   60.416666666666664% used
To Space:
   capacity = 1572864 (1.5MB)
   used     = 0 (0.0MB)
   free     = 1572864 (1.5MB)
   0.0% used
PS Old Generation
   capacity = 22544384 (21.5MB)
   used     = 21187512 (20.20598602294922MB)
   free     = 1356872 (1.2940139770507812MB)
   93.9813303392987% used

16212 interned Strings occupying 2160560 bytes.

MAT分析内存溢出
工具下载
导入文件显示怀疑内存溢出（Leak suspects）

选择直方图

找到影响最大的项目，右键查看强引用以判断这些占用内存大的对象由谁引用，由此定位内存溢出问题


选择实体树

也可看出存在大量对象加载

jstack
分析线程状态
PS C:\Users\11860&amp;gt; jstack
Usage:
    jstack [-l] &amp;lt;pid&amp;gt;
        (to connect to running process)
    jstack -F [-m] [-l] &amp;lt;pid&amp;gt;
        (to connect to a hung process)
    jstack [-m] [-l] &amp;lt;executable&amp;gt; &amp;lt;core&amp;gt;
        (to connect to a core file)
    jstack [-m] [-l] [server_id@]&amp;lt;remote server IP or hostname&amp;gt;
        (to connect to a remote debug server)

Options:
    -F  to force a thread dump. Use when jstack &amp;lt;pid&amp;gt; does not respond (process is hung)
    -m  to print both java and native frames (mixed mode)
    -l  long listing. Prints additional information about locks
    -h or -help to print this help message

手动导出
jstack 23276 &amp;gt; RemoteMavenServerJstack

线程状态官方文档
[线程状态互相转化]https://mp.weixin.qq.com/s/GsxeFM7QWuR--Kbpb7At2w)
jstack定位CPU飙高问题
tomcat 远程监控
开启tomcat远程监控
startup.sh 在最后一行的&#39;start &amp;quot;$@&amp;quot;&#39;前加上&#39;jpda&#39;
catalina.sh 搜索jpda,可看到jpda使用说明

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/java8-sheng-chan-huan-jing-xia-xing-neng-jian-kong-yu-diao-you-xiang-jie-bi-ji">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/spring-data-jpa-zhi-shi-ji-lu">
                        Spring Data JPA 知识记录
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-09</time>
                    
                        <a href="https://fjiayang.github.io//tag/qV7V2kVvY" class="post-tag i-tag
                            i-tag-other_3">
            #Java
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            jpa方法命名规则



关键字
方法命名
sql where字句




And
findByNameAndPwd
where name= ? and pwd =?


Or
findByNameOrSex
where name= ? or sex=?


Is,Equals
findById,findByIdEquals
where id= ?


Between
findByIdBetween
where id between ? and ?


LessThan
findByIdLessThan
where id &amp;lt; ?


LessThanEquals
findByIdLessThanEquals
where id &amp;lt;= ?


GreaterThan
findByIdGreaterThan
where id &amp;gt; ?


GreaterThanEquals
findByIdGreaterThanEquals
where id &amp;gt; = ?


After
findByIdAfter
where id &amp;gt; ?


Before
findByIdBefore
where id &amp;lt; ?


IsNull
findByNameIsNull
where name is null


isNotNull,NotNull
findByNameNotNull
where name is not null


Like
findByNameLike
where name like ?


NotLike
findByNameNotLike
where name not like ?


StartingWith
findByNameStartingWith
where name like &#39;?%&#39;


EndingWith
findByNameEndingWith
where name like &#39;%?&#39;


Containing
findByNameContaining
where name like &#39;%?%&#39;


OrderBy
findByIdOrderByXDesc
where id=? order by x desc


Not
findByNameNot
where name &amp;lt;&amp;gt; ?


In
findByIdIn(Collection&amp;lt;?&amp;gt; c)
where id in (?)


NotIn
findByIdNotIn(Collection&amp;lt;?&amp;gt; c)
where id not  in (?)


TRUE
findByAaaTue
where aaa = true


FALSE
findByAaaFalse
where aaa = false


IgnoreCase
findByNameIgnoreCase
where UPPER(name)=UPPER(?)



常用注解
自动生成时间和修改者
@CreatedDate、@CreatedBy、@LastModifiedDate、@LastModifiedBy
在spring jpa中，支持在字段或者方法上进行注解@CreatedDate、@CreatedBy、@LastModifiedDate、@LastModifiedBy，从字面意思可以很清楚的了解，这几个注解的用处。
@CreatedDate
表示该字段为创建时间时间字段，在这个实体被insert的时候，会设置值
@CreatedBy
表示该字段为创建人，在这个实体被insert的时候，会设置值
@LastModifiedDate、@LastModifiedBy同理。
自动建表引擎设置
使用SpringDataJpa自动建表默认为MyISAM，而主流大多数场景都需要使用InnoDB，可通过配置文件配置即可
spring:
  jpa:
    database-platform: org.hibernate.dialect.MySQL55Dialect

注意：类名有所变化
早期通过网上搜索的类名都说为org.hibernate.dialect.MySQL5InnoDBDialect，当实际测试时发现引擎依然为MyISAM，通过进一步查询源码发现早期类名已经弃用
/*
 * Hibernate, Relational Persistence for Idiomatic Java
 *
 * License: GNU Lesser General Public License (LGPL), version 2.1 or later.
 * See the lgpl.txt file in the root directory or &amp;lt;http://www.gnu.org/licenses/lgpl-2.1.html&amp;gt;.
 */
package org.hibernate.dialect;

/** A Dialect for MySQL 5 using InnoDB engine
 *
 * @author Gavin King,
 * @author Scott Marlow
 * @deprecated Use &amp;quot;hibernate.dialect.storage_engine=innodb&amp;quot; environment variable or JVM system property instead.
 */
@Deprecated
public class MySQL5InnoDBDialect extends MySQL5Dialect {

	@Override
	protected MySQLStorageEngine getDefaultMySQLStorageEngine() {
		return InnoDBStorageEngine.INSTANCE;
	}
}


但注释里并没有指明新的替代类名，而是建议通过配置实现，但SpringDataJpa自动装配的类里没有支持该配置，故如果不单独引入hibernate依赖是无法使用该配置的
最后在stackoverflow上看到解决方案：where to put hibernate.dialect.storage_engine property
即使用新的类名org.hibernate.dialect.MySQL55Dialect替换即可，尽管两个类名初看没差别，实际上差了一个数字5，影响比较大
MySQL驱动变化
在使用了新版的驱动类后，不管是MyBatis还是Jpa，都会报时区不一致和报错信息乱码的错误需要将连接URL更新
新配置
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    username: root
    password: 
    url: jdbc:mysql://localhost/pw_manager?useSSL=false&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;serverTimezone=UTC

原配置
spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    username: cmsspringcloud
    password: cmsdbadmin
    url: jdbc:mysql://localhost:3306/cms_springcloud?characterEncoding=utf-8&amp;amp;useSSL=false


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/spring-data-jpa-zhi-shi-ji-lu">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/idea-chang-yong-kuai-jie-jian-windows">
                        IDEA常用快捷键-windows
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-09</time>
                    
                        <a href="https://fjiayang.github.io//tag/4ecKp1nP2" class="post-tag i-tag
                            i-tag-success">
            #IDE
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            查看方法的具体实现
ctrl+alt+鼠标点击
查找接口实现类
ctrl + alt +B
自动补全函数返回值
IDEA的ctrl+alt+v相当于eclipse的CTRL+F1
查找源码类
ctrl+N
查找方法
ctrl+F12
复制当前行到下一行
ctrl+D

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/idea-chang-yong-kuai-jie-jian-windows">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/scala-xue-xi-bi-ji">
                        Scala 学习笔记
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-09</time>
                    
                        <a href="https://fjiayang.github.io//tag/mwAPVTrct" class="post-tag i-tag
                            i-tag-">
            #Scala
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            伴生类与伴生对象
特点

同名的class与同名的object互为伴生类和伴生对象
若object中有名为apply的方法，则通过类名()会在类初始化完成后调用object的apply方法
若class有名为apply的方法，则通过对象()默认调用class的apply方法

object A{
    def apply(){
        ...
    }
}
class A{
    def apply(){
        ...
    }
}

val b = A() //此处默认调用object 的apply方法

val c = new A()
c() // 此处调用class 的apply方法


最佳实践：在object的apply方法中new class
trait
类似java的接口
用法
class A extends B with C with D ...

集合
List
特点

Nil 为不可变的空List
List由head和tail组成，head为第一个元素，剩余元素为tail
List组装通过::实现

val l1 = 1 :: Nil // 返回包含一个元素的集合List(1)，即把1作为head，Nil作为tail


List可通过:_*转成可变参数

l1.tail:_*

模式匹配
特点

类似java中的switch
支持多重过滤
支持内容、类型匹配

函数高级操作
字符串高级操作
插值
字符串前通过字母s声明，内容通过$接变量名即可
  val h = &amp;quot;hello&amp;quot;
  val name = &amp;quot;FJY&amp;quot;
  println(h +&amp;quot; &amp;quot;+ name) // hello FJY

  println(s&amp;quot;hello $name&amp;quot;) // hello FJY

输出结果相同
多行字符串
IDEA创建多行字符串：Shift+’ 按3次即可，创建结果为
  val b =
    &amp;quot;&amp;quot;&amp;quot;
      |
    &amp;quot;&amp;quot;&amp;quot;.stripMargin


样例

  val b =
    &amp;quot;&amp;quot;&amp;quot;
      |多行字符串样例
      |Hello Scala
    &amp;quot;&amp;quot;&amp;quot;.stripMargin

  println(b)

最终结果为原样输出
匿名函数
函数可以命名，也可以不命名
定义方式：（参数名：参数类型...）=&amp;gt; 函数体

样例1

    val m = (x:Int) =&amp;gt; x+1
    println(m(10)) // 11

(x:Int) =&amp;gt; x+1为匿名函数，等价于{(x:Int) =&amp;gt; x+1}
匿名函数可传给变量，也可传给函数

样例2

    def plus = (x:Int,y:Int)=&amp;gt; x+y
    println(plus(2,3)) // 5

柯里化函数

样例

    // 原函数
    def plus1(x:Int,y:Int)= x+y
    println(plus1(2,3))
    
    // 柯里化后
    def plus2(x:Int)(y:Int)= x+y
    println(plus2(2)(3))

即将多参数分拆
高阶函数
map
作用：逐个操作集合中的元素
list.map((x)=&amp;gt;x+1) // 对集合中的每个元素执行+1操作
list.map(_ * 2) // 集合中每个元素*2，_ 为占位符

其中x=&amp;gt;x+1为匿名函数，只有一个元素参数的函数括号可以省略
filter
作用：过滤
list.filter(_ &amp;gt; 2) // 只拿出大于2的元素

reduce
作用：操作两个元素
list.reduce(_ + _) // 集合中相邻的元素两两相加，即求和

reduceXX方法
reduceLeft,reduceRight,foldLeft,foldRight方法
val a = List(1,7,2,9)
val a1 = a.reduceLeft(_ - _)//      ((1-7) - 2) - 9 = -17
val a2 = a.foldLeft(0)(_ - _) //    0-1-7-2-9 = -19

对于foldLeft方法还有一种简写，这种写法的本意是让你通过/:来联想一棵树的样子
对/:操作符来说，初始值是第一个操作元本题中是0，：后是第二个操作元a
val a3 = (0 /: a)(_ - _) //      等价于a.foldLeft(0)(_ - _


foldRight或:\的变体

val a4 = a.foldRight(0)(_ - _)//    1-(7-(2-(9-0))) = -13
val a5 = (a :\ 0)(_ - _)   //    等价于a.foldRight(0)(_ - _)

flatten
作用：将多个集合元素转成一个集合元素
flatMap
作用：将多个集合元素转成一个集合后对每个元素执行操作

Spark word count

text_file.flatMap(lambda line : line.split()).map(lambda word:(word,1)).reduceByKey(lambda a, b:a+b)

即将文件中的元素拆分，再映射上一个初值，最后两两相加

原生scala实现wordcount

txts.flatMap(_.split(&amp;quot;,&amp;quot;)).map(x =&amp;gt; (x,1)).groupBy(_._1).mapValues(_.size).foreach(println)

偏函数
含义：被包在花括号内没有match的一组case语句
一般通过match实现方式
  val names = Array(&amp;quot;A&amp;quot;,&amp;quot;B&amp;quot;,&amp;quot;C&amp;quot;)
  val name = names(Random.nextInt(names.length))
  name match {
    case &amp;quot;A&amp;quot; =&amp;gt; &amp;quot;AAAAAAAA&amp;quot;
    case &amp;quot;B&amp;quot; =&amp;gt; &amp;quot;BBBBBBBB&amp;quot;
    case _ =&amp;gt; &amp;quot;CCCCCCCC&amp;quot;
  }

通过偏函数实现
  // -A 输入参数类型 -B 输出参数类型
  def say:PartialFunction[String,String]={
    case &amp;quot;A&amp;quot; =&amp;gt; &amp;quot;AAAAAAAA&amp;quot;
    case &amp;quot;B&amp;quot; =&amp;gt; &amp;quot;BBBBBBBB&amp;quot;
    case _ =&amp;gt; &amp;quot;CCCCCCCC&amp;quot;
  }

能自动进行模式匹配
隐式转换
解决问题：为一个已经存在的类添加一个方法
Java实现方式：动态代理
Scala实现方式：隐式转换
注意：该特性为双刃剑，容易使代码难以理解

Scala 2.10引入了一种叫做隐式类的新特性。隐式类指的是用implicit关键字修饰的类。在对应的作用域内，带有这个关键字的类的主构造函数可用于隐式转换。


样例

object ImplicitApp extends App {

  // 定义隐式转换函数，传入源对象，输出目标对象
  implicit def  man2superman(man: Man):Superman=new Superman(man.name)

  val man = new Man(&amp;quot;FJY&amp;quot;)
  man.fly()
}

class Man(val name:String){
  def eat(): Unit ={
    printf(s&amp;quot;man[ $name ] eat...&amp;quot;)
  }
}

class Superman(val name:String){
  def fly(): Unit ={
    printf(s&amp;quot;superman[ $name ] fly...&amp;quot;)
  }
}


样例2：为Java IO类增加读取文件内容方法

object RichFileApp extends App {

  // 目的在于为Java IO类增加读取文件内容方法
  implicit def file2RichFile(file: File):RichFile=new RichFile(file)

  val f = new File(&amp;quot;tmp/hello.txt&amp;quot;)
  println(f.readConent)
}

class RichFile(file:File){
  def readConent={
    Source.fromFile(file.getPath).mkString
  }
}

隐式参数
隐式参数会自动寻找方法、类内部、伴生类内类型匹配的唯一参数，不推荐使用

样例

object ImplicitParaApp {

  implicit val test = &amp;quot;test&amp;quot;
  def main(args: Array[String]): Unit = {

    // 隐式参数会自动寻找方法、类内部、伴生类内类型匹配的唯一参数
    // 若外部定义了多个隐式参数则报错
    def testPara(implicit name:String): Unit ={
      println(name + &amp;quot;...&amp;quot;)
    }

    testPara
  }

}

隐式类
使用隐式类时，类名必须在当前作用域内可见且无歧义，这一要求与隐式值等其他隐式类型转换方式类似。
object ImplicitClassApp extends App {

  implicit class Calculator(x:Int){
    def add(a:Int) = a+x
  }
  // 原本整数1不具有add方法，使用隐式类后拥有该方法
  println(1.add(2))

}

操作外部数据
scala.io.Source
该对象支持操作文件、网络流等，例如读取文件方法源码支持通过柯里化指定字符集
  def fromFile(name: String)(implicit codec: Codec): BufferedSource =
    fromFile(new JFile(name))(codec)


样例——读取文件

val file = Source.fromFile(&amp;quot;tmp/file.txt&amp;quot;)(Codec.UTF8)


样例——逐行读取

  def readLine(file: BufferedSource): Unit ={
    for (line &amp;lt;- file.getLines()){
      println(line)
    }
  }


样例——逐个字符读取

  def readChar(file: BufferedSource): Unit ={
    for (ele &amp;lt;- file){
      print(ele)
    }
  }


样例——网络读取

  def readNet(url:String): Unit ={
    val file = Source.fromURL(url)
    for (line &amp;lt;- file.getLines()){
      println(line)
    }
  }


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/scala-xue-xi-bi-ji">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/linux-mian-ban-appnode-yu-bao-ta-heng-ping">
                        Linux面板APPNODE与宝塔横评
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-09</time>
                    
                        <a href="https://fjiayang.github.io//tag/d2Pd4JZcy" class="post-tag i-tag
                            i-tag-other_2">
            #评测
        </a>
                        
                        <a href="https://fjiayang.github.io//tag/P0Y0B_QdTG" class="post-tag i-tag
                            i-tag-error">
            #宝塔
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            宝塔
宝塔从2017年底开始接触并全面在自己服务器上推广使用，到目前为止手上的服务器需要建站数据库之类的都部署了宝塔，同时开发测试环境的服务器为了方便管理也部署了宝塔，可以说用了也算比较长时间了，宝塔的优势也比较明显
1. 界面简单，逻辑明确
系统信息一目了然

2. 软件安装简单
基本都是无脑安装，之前在开发测试环境搭建Redis和MySQL就是通过宝塔快速安装的，5分钟内搭建完毕快速测试，而且卸载的比较干净，特别是如果小白自己下载MySQL编译包安装很容易出现卸载残留导致无法安装新的MySQL

3. 快捷的防火墙管理
宝塔提供的防火墙管理基本满足需求，比使用防火墙命令逐个放行便捷

总结
总的来说宝塔适合建站管理，快速应用部署，但对于复杂的操作还是需要自行通过终端解决，而且防火墙功能有限，抗CC攻击等都需要付费或者搭建其他软件
APPNODE
在最近看到APPNODE这个管理面板，在虚拟机跑了一下发现其功能强大，还是有点意思的。
以下逐一说明（无广告费）
1. 简单安装
其实APPNODE和宝塔都是一键安装，自选服务器环境这些共同点，从这点上来说没什么差别，两者甚至连默认端口号都是一样的。。

装好后的首页，默认展示建站指引（好评，第一次在宝塔建站还是摸索了一会的）

更详细的服务器信息
展示的服务器信息比宝塔详细很多，各项指标都有展示



更多的系统软件
可以安装许多软件目前都是免费的，软件也和宝塔类型类似，但有一些特别的，比如frp内网穿透之类还是不错的，比自己部署简单不少，不知道以后会不会收费

网络测试软件看看就好

更丰富的软件市场
和宝塔类似的软件市场，同样种类更多，有些2017年才兴起的小众软件也在里面，也有不少刚需平台例如owncloud、nextcloud，而同样用宝塔搭建私有云还是挺折腾的

功能完备的防火墙管理（重点）
在我看来这个是与宝塔最大的不同，前面那些只要宝塔想加入其实也不难，但这个支持自己配置的防火墙规则，其实内部实现应该是通过nginx代理配置实现，但比宝塔收费的要良心，通过简单设置参数即可抵抗简单的DDOS攻击

攻击测试，通过Apache ab压测进行DDOS攻击
未开启之前所有请求顺利通过

在配置1秒内最大访问次数后成功拦截，1000个请求只有70个有效，说明DDOS流量劫持被成功拦截

更灵活的网站控制
日志、SSL、负载情况、网站更新自动提醒重载nginx等
另外还提供免费SSL证书自动续租，十分好评

总结
APPNODE适合对服务器操作熟悉，需要更大灵活度的定制服务器功能的用户，对于建站灵活度也非常高，而缺点也比较明显，功能多必然带来操作复杂，许多功能小白可能没听过，乱操作一波可能会翻车。。

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/linux-mian-ban-appnode-yu-bao-ta-heng-ping">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/redis-duo-chong-qi-dong-pei-zhi-fang-shi">
                        redis多种启动配置方式
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-09</time>
                    
                        <a href="https://fjiayang.github.io//tag/4QCDLcnCA" class="post-tag i-tag
                            i-tag-error">
            #Redis
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            总览
三种启动方式：

动态参数启动（指定端口号）
配置文件启动（生产环境推荐）
最简单启动

官方安装指南
安装前置环境gcc-c++
$ yum install -y gcc-c++

官方下载安装文档
$ wget http://download.redis.io/releases/redis-5.0.0.tar.gz
$ tar xzf redis-5.0.0.tar.gz
$ cd redis-5.0.0
$ make MALLOC=libc
$ make install

编译后在src目录下生成可执行文件
$ ls | grep redis-

redis-benchmark ——性能测试
redis-benchmark.c
redis-benchmark.o
redis-check-aof ——aof修复
redis-check-aof.c
redis-check-aof.o
redis-check-rdb ——rdb修复
redis-check-rdb.c
redis-check-rdb.o
redis-cli ——客户端
redis-cli.c
redis-cli.o
redis-sentinel ——集群
redis-server ——服务器
redis-trib.rb

启动
简单启动
$ redis-server 
2660:C 21 Nov 2018 20:01:10.958 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
2660:C 21 Nov 2018 20:01:10.958 # Redis version=5.0.0, bits=64, commit=00000000, modified=0, pid=2660, just started
2660:C 21 Nov 2018 20:01:10.958 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
2660:M 21 Nov 2018 20:01:10.959 * Increased maximum number of open files to 10032 (it was originally set to 1024).
                _._                                                  
           _.-``__ &#39;&#39;-._                                             
      _.-``    `.  `_.  &#39;&#39;-._           Redis 5.0.0 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._                                   
 (    &#39;      ,       .-`  | `,    )     Running in standalone mode
 |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6379
 |    `-._   `._    /     _.-&#39;    |     PID: 2660
  `-._    `-._  `-./  _.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io        
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |                                  
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
      `-._    `-.__.-&#39;    _.-&#39;                                       
          `-._        _.-&#39;                                           
              `-.__.-&#39;                                               

2660:M 21 Nov 2018 20:01:10.961 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
2660:M 21 Nov 2018 20:01:10.961 # Server initialized
2660:M 21 Nov 2018 20:01:10.961 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.
2660:M 21 Nov 2018 20:01:10.961 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &amp;gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.
2660:M 21 Nov 2018 20:01:10.961 * Ready to accept connections

客户端连接测试
$ redis-cli -h 127.0.0.1 -p 6379
127.0.0.1:6379&amp;gt; ping
PONG
127.0.0.1:6379&amp;gt; set hello world
OK
127.0.0.1:6379&amp;gt; get hello
&amp;quot;world&amp;quot;

动态参数启动
$ redis-server --port 6380

连接默认端口测试
$ redis-cli -h 127.0.0.1 -p 6379
Could not connect to Redis at 127.0.0.1:6379: Connection refused
not connected&amp;gt; exit

连接新端口测试
$ redis-cli -h 127.0.0.1 -p 6380
127.0.0.1:6380&amp;gt; ping
PONG
127.0.0.1:6380&amp;gt; exit

通过进程查看
$ ps -ef | grep redis-server |grep -v grep
root       2666   1469  0 20:04 pts/0    00:00:00 redis-server *:6380

配置文件启动
拷贝默认配置
$ pwd
/root/redis-5.0.0
$ mkdir config
$ cp redis.conf config/
$ cd config/
$ ls
redis.conf

查看默认配置，以下命令用于去除注释和空格
$ cat redis.conf | grep -v &amp;quot;#&amp;quot; | grep -v &amp;quot;^$&amp;quot; &amp;gt; redis-default.conf
$ cat redis-default.conf 
bind 127.0.0.1
protected-mode yes
port 6379 #端口号
tcp-backlog 511
timeout 0
tcp-keepalive 300
daemonize no #默认非守护进程启动
supervised no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile &amp;quot;&amp;quot; #日志文件名称
databases 16
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir ./ #工作目录
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
replica-priority 100
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no
appendonly no
appendfilename &amp;quot;appendonly.aof&amp;quot;
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events &amp;quot;&amp;quot;
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes

由于默认配置redis为单线程，故一台服务器一般起多个redis实例，配置文件以端口号区分
$ cp redis-default.conf redis-6379.conf
$ ll
总用量 72
-rw-r--r--. 1 root root    65 11月 21 20:46 redis-6379.conf
-rw-r--r--. 1 root root 62155 11月 21 20:36 redis.conf
-rw-r--r--. 1 root root  1425 11月 21 20:41 redis-default.conf

简化配置如下：
port 6380
daemonize yes
logfile &amp;quot;6380.log&amp;quot;
dir &amp;quot;/root/tmp/redis&amp;quot;

配置文件启动
 $ redis-server config/redis-6380.conf


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/redis-duo-chong-qi-dong-pei-zhi-fang-shi">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://fjiayang.github.io//post/ji-li-tui-jian-de-wang-luo-jia-su-ti-zi-fu-wu">
                        极力推荐的网络加速（梯子）服务
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2018-12-09</time>
                    
                        <a href="https://fjiayang.github.io//tag/d2Pd4JZcy" class="post-tag i-tag
                            i-tag-">
            #评测
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            地址
5折圣诞优惠码：CHRISTMASANDNEWYEAR ，账户内现有产品可使用优惠码 RENEW2019 获得 35% off 续约折扣
AAEX
原因
从最开始使用免费账号到坚持自建服务器搭建专线梯子，一直认为专线梯子才是王道，何必花钱购买别人的昂贵加速服务，然而。。直到发现AAEX。。其与自建服务器区别如下
默认套餐
默认套餐对自建服务器的吸引不大而且和其他服务提供商产品类型差不多，适用于视频搬运。另外，因为自建服务器成本和套餐差距不大，除了需要自己维护之外没太大区别，而且自建服务器还有台服务器可以折腾

对于本人来说一般就偶尔看个视频，自建服务器一个月才3-5刀，还不限流量，但缺点也是节点有限，而且带宽流量极大浪费，然后发现了另一个隐藏套餐
固定流量包
这个就比较有意思了，按量付费，和买运营商流量包一样，按需购买，还不清零，永久有效，对于查阅资料，游戏玩家来说还是非常友好的，而且所有节点均可用


本人试了下买了200多G的流量套餐100块，38个节点随便用，全平台支持（好评，特别是苹果用户，下载客户端非常麻烦，而且一般还要付费），AAEX官方提供appleID下载梯子app（满分）

效果
常见的控制台，多个香港节点，延迟低带宽大

使用RSS订阅客户端自动更新节点，同时带有流量统计，比原生的SSR体验好了不少

全节点均可用

通过在线视频和网页测试基本秒开，在线4K无压力，带宽也能跑满本地带宽（20M）
总结
一趟测试下来，优点如下

无需自己购买和搭建服务器
无需担心IP被墙
多节点选择，延迟低（自建服务器香港、日本机房贼贵）
固定流量包，不清零
全平台支持

用了这个之后基本就告别自建服务器的梯子了。。

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://fjiayang.github.io//post/ji-li-tui-jian-de-wang-luo-jia-su-ti-zi-fu-wu">Read More ~</a>
                            </div>
                </div>
            </article>
            
                <!-- 翻页 -->
                
    <div class="pagination-container">
        
            <a href="https://fjiayang.github.io//page/2/" class="page-btn btn">上一页</a>
            
                
                    <a href="https://fjiayang.github.io//page/4/" class="page-btn btn">下一页</a>
                    
    </div>
    
                </div>
                <!--  -->
                <div class="main-container-middle"></div>
                <!--  -->
                <div id="sidebar" class="main-container-right">

                    <!-- 个人信息 -->
                    
    <div class="id_card i-card">
        <div class="id_card-avatar" style="background-image: url(https://fjiayang.github.io//images/avatar.png?v=1575531807323)">
        </div>
        <h1 class="id_card-title">
            F嘉阳
        </h1>
        <h2 class="id_card-description">
            温故而知新
        </h2>
        <!--  -->
        <div class="id_card-sns">
            <!-- github -->
            
                    <!-- twitter -->
                    
                            <!-- weibo -->
                            
                                <a href="https://weibo.com/2007780675" target="_blank" rel="noopener noreferrer"><i
                class="fa fa-weibo"></i></a>
                                
                                    <!-- facebook -->
                                    

        </div>
    </div>
    

                        <!-- 公告栏 -->
                        
    <div class="notice-card i-card ">
        <div class="notice-title i-card-title">公告</div>
        <div class="notice-content">
            主博客：https://blog.fjy8018.top/
        </div>
    </div>
    

                </div>
            </div>



            <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a href="https://blog.fjy8018.top/" target="_blank">F嘉阳 博客</a> | 
  <a class="rss" href="https://fjiayang.github.io//atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
</body>

</html>