<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    DevOps实践心得一 | F嘉阳
</title>
<link rel="shortcut icon" href="https://fjiayang.github.io//favicon.ico?v=1575362626651">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://fjiayang.github.io//styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://fjiayang.github.io//media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


        
</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="https://fjiayang.github.io/">
                <img class="avatar" src="https://fjiayang.github.io//images/avatar.png?v=1575362626651" alt="">
            </a>
            <div class="site-title">
                <h1>
                    F嘉阳
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="/" class="menu">
                                    首页
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/archives" class="menu">
                                    归档
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/tags" class="menu">
                                    标签
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/post/about" class="menu">
                                    关于
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-detail main-container">
                <!-- left -->
                <div id="content" class="main-container-left">
                    <article class="post i-card">
                        <h2 class="post-title">
                            DevOps实践心得一
                        </h2>
                        <div class="post-info">
                            <time class="post-time">2019-08-16</time>
                            
                                <a href="https://fjiayang.github.io//tag/dgP0uMsX9" class="post-tag i-tag
                            i-tag-other_4">
                            #Ansible
                        </a>
                                
                                <a href="https://fjiayang.github.io//tag/55CGdWlsfz" class="post-tag i-tag
                            i-tag-">
                            #Jenkins
                        </a>
                                
                                <a href="https://fjiayang.github.io//tag/xTpEEjjmQ" class="post-tag i-tag
                            i-tag-banana">
                            #mesos
                        </a>
                                
                                <a href="https://fjiayang.github.io//tag/tAci1rZfHp" class="post-tag i-tag
                            i-tag-banana">
                            #DevOps
                        </a>
                                
                                <a href="https://fjiayang.github.io//tag/FZ58cYbuWL" class="post-tag i-tag
                            i-tag-other_2">
                            #marathon
                        </a>
                                
                                <a href="https://fjiayang.github.io//tag/3x3ut1pT9" class="post-tag i-tag
                            i-tag-success">
                            #GitLab
                        </a>
                                
                                <a href="https://fjiayang.github.io//tag/kTPZcu1_NZ" class="post-tag i-tag
                            i-tag-other_2">
                            #Docker
                        </a>
                                
                        </div>
                        
                                <div class="post-content">
                                    <h2 id="初遇devops">初遇DevOps</h2>
<p>最早接触到<code>DevOps</code>是在2018年8月26日，那时首先接触到的就是大名鼎鼎的<code>Jenkins</code>，当时看了多篇关于持续集成和持续部署的文章，蠢蠢欲动，便开始了第一套<code>DevOps</code>环境的搭建</p>
<!-- more -->
<h2 id="jenkins">Jenkins</h2>
<p>第一套<code>DevOps</code>是用<code>Jenkins</code>+<code>Ansible</code>+<code>GitLab</code>搭建的，那时只是了解Docker的好处，并没有使用Docker搭建整套环境，还是基于传统虚拟服务器搭建的整套流程。</p>
<p><code>Jenkins</code>不仅可以编写<code>groove</code>脚本、pipeline 流水线等，还能与<code>maven</code>集成自动构建，深深感受到了<code>Jenkins</code>的强大，同时大量的用户为其贡献了许多插件，有很多实践问题都可以在网上搜索到解决方案</p>
<p>搭建过程：</p>
<p><a href="https://blog.fjy8018.top/index.php/archives/208/">gitlab-ce安装配置</a></p>
<p><a href="https://blog.fjy8018.top/index.php/archives/175/">Ansible安装配置</a></p>
<p><a href="https://blog.fjy8018.top/index.php/archives/177/">Ansible Playbook编写测试</a></p>
<p><a href="https://blog.fjy8018.top/index.php/archives/179/">Jenkins 安装配置</a></p>
<p><a href="https://blog.fjy8018.top/index.php/archives/178/">Jenkins job编写测试</a></p>
<p><a href="https://blog.fjy8018.top/index.php/archives/180/">Jenkins 与Maven集成</a></p>
<p>最后顺利实现了静态网站持续集成、持续部署，详见：<a href="https://blog.fjy8018.top/index.php/archives/181/">Jenkins+GitLab+Ansible实现静态网站自动部署</a></p>
<h2 id="dockergitlab">Docker+GitLab</h2>
<p>随着容器化技术在国内越来越流行，容器普及度越来越高，其带来的环境隔离极大推动了<code>DevOps</code>的落地，使得无需使用<code>python</code>环境隔离，可以直接利用容器技术实现跨平台和环境隔离，并且利于迁移和部署</p>
<p>于是在2019年4月开始研究<code>GitLab</code>官方文档，发现其早已原生支持流水线，并依托其<code>GitLab-runner</code>可以直接实现整套<code>DevOps</code>环境</p>
<p>因此，经过不断摸索，完整的搭建的基于<code>Docker</code>和<code>GitLab</code>的<code>DevOps</code>环境，搭建过程见：</p>
<p><a href="https://blog.fjy8018.top/index.php/archives/205/">DevOps GitLab CICD 实践1——GitLab 部署</a></p>
<p><a href="https://blog.fjy8018.top/index.php/archives/206/">DevOps GitLab CICD 实践2——Runner 部署</a></p>
<p><a href="https://blog.fjy8018.top/index.php/archives/207/">DevOps GitLab CICD 实践3——CI文件编写</a></p>
<p>由于国内当时对<code>GitLab</code>流水线使用的并不多，因此遇到的很多坑都需要翻查官方文档和国外的实践记录，比如：</p>
<p><a href="https://blog.fjy8018.top/index.php/archives/208/">Docker 19.03 版本对原Gitlab-Runner的影响</a></p>
<h2 id="devops-带来的好处">DevOps 带来的好处</h2>
<p>2019年7月将手上的一个小型项目尝试使用完整的<code>DevOps</code>流程开发，开发小组选择敏捷开发方法，所有的开发工具都尽量的适应快速的需求变化，同时投入非常少量的开发人员，分工明确，从一开始一周发布一次到最后一天可以发布多次</p>
<figure data-type="image" tabindex="1"><img src="https://fjy8018.gitee.io/images/img/1565881026961.png" alt=""></figure>
<p>开发人员已经完全从运维中脱离，全团队没有专门的运维人员，极大的提高了开发效率，精简了人员构成，一旦构建失败，开发人员可以根据邮件通知的内容排查上线失败问题，调整代码和配置后重新提交</p>
<figure data-type="image" tabindex="2"><img src="https://fjy8018.gitee.io/images/img/1565881202626.png" alt=""></figure>
<p>面板提供了流水线统计图，如果出现频繁的失败还是需要人工介入，查看问题原因</p>
<figure data-type="image" tabindex="3"><img src="https://fjy8018.gitee.io/images/img/1565881072564.png" alt=""></figure>
<h2 id="当前的问题">当前的问题</h2>
<p>尽管使用了基于<code>Docker</code>+<code>GitLab</code>的流水线实现了完整的<code>DevOps</code>流程，但对于监控和日志部分仍然处在很多问题</p>
<ul>
<li>尽管上线的是单体应用，服务器和应用的健康状态都无法得知，也没有相应的告警</li>
<li>应用的日志没有被外部服务收集，无法进行快速分析</li>
<li>没有实现完整的测试流程，生成测试覆盖率报告等</li>
<li>没有实现0停机上线，在容器切换时仍需停机1-2分钟</li>
<li>没有实现灰度上线、蓝绿部署等，上线失败需要手动回滚</li>
</ul>
<h2 id="未来探索方向">未来探索方向</h2>
<ul>
<li>全面容器化服务治理方向
<ul>
<li>国内对容器化有非常多的实践</li>
<li><code>kubernetes</code>作为容器调度成为大多数服务治理的选择</li>
<li>容器隔离、迁移和伸缩带来的巨大优势</li>
</ul>
</li>
<li>容器与传统应用部署结合方式
<ul>
<li>以半全自动方式落地<code>DevOps</code>，采用<code>Mesos</code>+<code>marathon</code>方式同时兼容传统服务部署和容器化部署</li>
<li>兼容分布式服务治理</li>
<li>国外有大量的实践案例</li>
<li>日志收集体系完备</li>
</ul>
</li>
</ul>

                                </div>
                    </article>
                    <!--  -->
                    
                        <div class="next-post">
                            <div class="next">下一篇</div>
                            <a href="https://fjiayang.github.io//post/centos-7-an-zhuang-kvm-he-webvirtmgr-guan-li-mian-ban">
                                <h3 class="post-title">
                                    CentOS 7 安装KVM和WebVirtMgr管理面板
                                </h3>
                            </a>
                        </div>
                        
                            <div id="disqus_thread"></div>
                            <div id="gitalk-container"></div>
                </div>
                <!-- middle -->
                <div class="main-container-middle"></div>
                <!-- right -->
                <div id="sidebar" class="main-container-right">
                    
                        <!-- toc -->
                        
    <div class="toc-card i-card ">
        <div class="toc-title i-card-title">目录</div>
        <div class="toc-content">
            <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%88%9D%E9%81%87devops">初遇DevOps</a></li>
<li><a href="#jenkins">Jenkins</a></li>
<li><a href="#dockergitlab">Docker+GitLab</a></li>
<li><a href="#devops-%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%A5%BD%E5%A4%84">DevOps 带来的好处</a></li>
<li><a href="#%E5%BD%93%E5%89%8D%E7%9A%84%E9%97%AE%E9%A2%98">当前的问题</a></li>
<li><a href="#%E6%9C%AA%E6%9D%A5%E6%8E%A2%E7%B4%A2%E6%96%B9%E5%90%91">未来探索方向</a></li>
</ul>
</li>
</ul>

        </div>
        <script>
            function locateCatelogList() {
                /*获取文章目录集合,可通过:header过滤器*/
                var alis = $('.post-content :header');
                /*获取侧边栏目录列表集合**/
                var sidebar_alis = $('.markdownIt-TOC a');
                /*获取滚动条到顶部的距离*/
                var scroll_height = $(window).scrollTop();
                for (var i = 0; i < alis.length; i++) {
                    /*获取锚点集合中的元素分别到顶点的距离*/
                    var a_height = $(alis[i]).offset().top;
                    if (a_height < scroll_height) {
                        /*高亮显示*/
                        sidebar_alis.removeClass('on');
                        $(sidebar_alis[i]).addClass('on');
                    }
                }
            }
            $(function() {
                /*绑定滚动事件 */
                $(window).bind('scroll', locateCatelogList);
            });
        </script>
    </div>
    
                            

                </div>




            </div>


            <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
<!--覆盖默认样式-->
<style type="text/css">
			.header {   
					height:64px !important;
			}
			.post-title{
					border:none !important;
			}
			.btn-text{    
					width: 80px;
					height: 18px;
					overflow: hidden;
			}
			.site-title h1{
					font-weight:400 !important;
					margin-left:10px !important;
					margin-right:0 !inportant;
			}

			.id_card .id_card-avatar{
					padding:4px !important;
			}
			.post-content-abstract{
					max-width: 600px !important;
					max-height: 100px !important;
					overflow: hidden;
			}
			.post-content-abstract *{
					font-size:14px !important;
					display:inline-block !important;
					margin:0 0 2px 0 !important;
					font-weight:300 !important;
			}

</style> | 
  <a class="rss" href="https://fjiayang.github.io//atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>


    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
    
</body>

</html>